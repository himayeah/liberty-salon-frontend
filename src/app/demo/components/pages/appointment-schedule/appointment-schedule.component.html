<div class="container my-4">
  <!-- Appointment Schedule Form -->
  <div class="card shadow-sm">
    <div class="card-header bg-primary text-white">
      <h4 class="mb-0">Appointment Schedule</h4>
    </div>
    <div class="card-body">
      <form [formGroup]="appointmentScheduleForm" (ngSubmit)="onSubmit()">
        <div class="row g-3">

          <!-- Client Name -->
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Client Name</mat-label>
              <mat-select formControlName="clientId">
                //client of clients refers to one client object of the clients array(retrieved from the database)
                <mat-option *ngFor="let client of clients" [value]="client.id">
                  {{ client.firstName }} {{ client.lastName }}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="submitted && appointmentScheduleForm.get('clientId')?.hasError('required')">
                Client is required
              </mat-error>
            </mat-form-field>
          </div>

          <!-- Stylist Name -->
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Stylist Name</mat-label>
              <mat-select formControlName="stylistId">
                //stylist of stylists refers to one stylist object of the stylists array(retrieved from the database)
                <mat-option *ngFor="let stylist of stylists" [value]="stylist.id">
                  {{ stylist.firstName }} {{ stylist.lastName }}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="submitted && appointmentScheduleForm.get('stylistId')?.hasError('required')">
                Stylist is required
              </mat-error>
            </mat-form-field>
          </div>
          
          <!-- Service -->
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Service</mat-label>
              <mat-select formControlName="serviceId">
                <mat-option *ngFor="let service of services" [value]="service.id">
                  {{ service.name }}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="submitted && appointmentScheduleForm.get('serviceId')?.hasError('required')">
                Service is required
              </mat-error>
            </mat-form-field>
          </div>

          <!-- Appointment Date -->
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Appointment Date</mat-label>
              <input matInput [matDatepicker]="picker" formControlName="appointmentDate" placeholder="Choose a date" />
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
              <mat-error *ngIf="submitted && appointmentScheduleForm.get('appointmentDate')?.hasError('required')">
                Appointment Date is required
              </mat-error>
            </mat-form-field>
          </div>

          <!-- Appointment Start Time -->
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Start Time</mat-label>
              <input matInput type="time" formControlName="appointmentStartTime" placeholder="HH:MM" />
              <mat-error *ngIf="submitted && appointmentScheduleForm.get('appointmentStartTime')?.hasError('required')">
                Start Time is required
              </mat-error>
            </mat-form-field>
          </div>

          <!-- Appointment End Time -->
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>End Time</mat-label>
              <input matInput type="time" formControlName="appointmentEndTime" placeholder="HH:MM" />
              <mat-error *ngIf="submitted && appointmentScheduleForm.get('appointmentEndTime')?.hasError('required')">
                End Time is required
              </mat-error>
            </mat-form-field>
          </div>
          <!-- Appointment Status -->
          <div class="col-md-6">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Status</mat-label>
              <mat-select formControlName="appointmentStatus">
                <mat-option *ngFor="let s of appointmentStatuses" [value]="s.value">{{ s.viewValue }}</mat-option>
              </mat-select>
              <mat-error *ngIf="submitted && appointmentScheduleForm.get('appointmentStatus')?.hasError('required')">
                Status is required
              </mat-error>
            </mat-form-field>
          </div>

          <!--Booking Source-->
          <div class="col-md-6">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Booking Source</mat-label>
              <mat-select formControlName="bookingSource">
                <mat-option *ngFor="let s of bookingSources" [value]="s.value">{{ s.viewValue }}</mat-option>
              </mat-select>
              <mat-error *ngIf="submitted && appointmentScheduleForm.get('bookingSource')?.hasError('required')">
                Booking Source is required
              </mat-error>
            </mat-form-field>
          </div>

          <!-- Notes -->
          <div class="col-md-6">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Notes</mat-label>
              <textarea matInput formControlName="notes" placeholder="Enter notes here..."></textarea>
            </mat-form-field>
          </div>

          <!-- Cancellation Reason -->
          <div class="col-md-6">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Cancellation Reason</mat-label>
              <textarea matInput formControlName="notes" placeholder="Enter cancellation reason here..."></textarea>
            </mat-form-field>
          </div>
        </div>

        <!-- Buttons -->
        <div class="d-flex justify-content-end mt-4">
          <button type="submit" mat-raised-button color="primary" [disabled]="isButtonDisabled">{{saveButtonLabel}}</button>
          <button type="button" mat-stroked-button class="ms-2" (click)="resetData()">Reset</button>
        </div>
      </form>
    </div>
  </div>

<!-- Table Section --> 
<div class="card shadow-sm mt-5">
    <div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
      <h4 class="mb-0">Appointment Information</h4>
      <button mat-icon-button color="light" (click)="refreshData()" matTooltip="Refresh">
        <mat-icon>refresh</mat-icon>
      </button>
    </div>
    <div class="card-body">
      <div class="row mb-3">
        <div class="col-md-4">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Filter</mat-label>

            <input matInput (keyup)="applyFilter($event)" placeholder="Search Appointments" />

          </mat-form-field>
        </div>
      </div>
      <div class="table-responsive">
        <table mat-table [dataSource]="dataSource" matSort class="table table-hover align-middle">
          <!--Columns -->
          <ng-container matColumnDef="clientName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Client Name </th>
            <td mat-cell *matCellDef="let element">{{ element.clientName || (element.client ? (element.client.firstName + ' ' + element.client.lastName) : '') }}</td>
          </ng-container>

          <ng-container matColumnDef="stylistName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Stylist Name </th>
            <td mat-cell *matCellDef="let element">{{ element.stylistName || (element.stylist ? (element.stylist.firstName + ' ' + element.stylist.lastName) : '') }}</td>
          </ng-container>

          <ng-container matColumnDef="serviceName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Service Name </th>
            <td mat-cell *matCellDef="let element">{{ element.serviceName || (element.service ? element.service.name : '') }}</td>

          </ng-container>
          <ng-container matColumnDef="appointmentDate">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Appointment Date </th>
            <td mat-cell *matCellDef="let element">{{ element.appointmentDate | date:'mediumDate' }}</td>
          </ng-container>

          <ng-container matColumnDef="appointmentStartTime">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Start Time </th>
            <td mat-cell *matCellDef="let element">{{ element.appointmentStartTime || (element.appointmentDate ? (element.appointmentDate | date:'shortTime') : '') }}</td>
          </ng-container>

          <ng-container matColumnDef="appointmentEndTime">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> End Time </th>
            <td mat-cell *matCellDef="let element">{{ element.appointmentEndTime || '' }}</td>
          </ng-container>

          <ng-container matColumnDef="appointmentStatus">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Status </th>
            <td mat-cell *matCellDef="let element">{{ element.appointmentStatus }}</td>
          </ng-container>

          <ng-container matColumnDef="bookingSource">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Booking Source </th>
            <td mat-cell *matCellDef="let element">{{ element.bookingSource }}</td>
          </ng-container>

          <ng-container matColumnDef="notes">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Notes </th>
            <td mat-cell *matCellDef="let element">{{ element.notes }}</td>
          </ng-container>

          <ng-container matColumnDef="cancellationReason">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Cancellation Reason </th>
            <td mat-cell *matCellDef="let element">{{ element.notes }}</td>
          </ng-container>

          <!--Action column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef> Actions </th>
            <td mat-cell *matCellDef="let element">
              <button mat-icon-button color="primary" (click)="editData(element)" matTooltip="Edit">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button color="warn" (click)="deleteData(element)" matTooltip="Delete">
                <mat-icon>delete</mat-icon>
              </button>
            </td>
          </ng-container>
          <!-- Rows -->
          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"
              [ngClass]="{
                'table-primary': selectedRow?.id === row.id,
                'table-success': lastAddedRow?.id === row.id,
                'table-warning': lastEditedRow?.id === row.id
              }">
          </tr>
        </table>
      </div>
      <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>
    </div>
  </div>

</div>
